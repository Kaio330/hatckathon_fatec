<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Chamados - Infraestrutura</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="main-page">

  <header>
    <div style="display: flex; align-items: flex-start; gap: 0.7rem;">
      <div class="logo">üìò</div>
      <div>
        <h1>Sistema de Chamados - Infraestrutura</h1>
        <p>e infraestrutura</p>
      </div>
    </div>
    <button class="logout-btn" id="logoutBtn">Sair</button>
  </header>

  <section class="cards">
    <div class="card"><p>Total</p><strong id="total">0</strong></div>
    <div class="card"><p>Abertos</p><strong id="abertos">0</strong></div>
    <div class="card"><p>Em Andamento</p><strong id="andamento">0</strong></div>
    <div class="card"><p>Resolvidos</p><strong id="resolvidos">0</strong></div>
  </section>

  <button class="btn" id="novoChamadoBtn">+ Abrir Novo Chamado</button>

  <section class="section">
    <h2>Chamados</h2>

    <div class="filters">
      <select id="filterStatus">
        <option value="todos">Todos os Status</option>
        <option value="Aberto">Aberto</option>
        <option value="Em Andamento">Em Andamento</option>
        <option value="Resolvido">Resolvido</option>
      </select>

      <select id="filterCategoria">
        <option value="todas">Todas as Categorias</option>
        <option value="Rede">Rede</option>
        <option value="Hardware">Hardware</option>
        <option value="Software">Software</option>
        <option value="El√©trica">El√©trica</option>
        <option value="Hidr√°ulica">Hidr√°ulica</option>
        <option value="Climatiza√ß√£o">Climatiza√ß√£o</option>
      </select>

      <select id="filterPrioridade">
        <option value="todas">Todas as Prioridades</option>
        <option value="Baixa">Baixa</option>
        <option value="M√©dia">M√©dia</option>
        <option value="Alta">Alta</option>
      </select>
    </div>

    <div id="listaChamados" class="empty">
      Nenhum chamado encontrado com os filtros selecionados.
    </div>
  </section>

  <!-- MODAL -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h3 id="modalTitulo">Novo Chamado</h3>
      <input type="text" id="titulo" placeholder="T√≠tulo do chamado" required>
      <textarea id="descricao" placeholder="Descri√ß√£o detalhada"></textarea>
      <input type="text" id="local" placeholder="Local (ex: Bloco A - 3¬∫ andar)">
      <select id="categoria">
        <option value="Rede">Rede</option>
        <option value="Hardware">Hardware</option>
        <option value="Software">Software</option>
        <option value="El√©trica">El√©trica</option>
        <option value="Hidr√°ulica">Hidr√°ulica</option>
        <option value="Climatiza√ß√£o">Climatiza√ß√£o</option>
      </select>
      <select id="prioridade">
        <option value="Baixa">Baixa</option>
        <option value="M√©dia">M√©dia</option>
        <option value="Alta">Altaaa</option>
      </select>
      <select id="status">
        <option value="Aberto">Aberto</option>
        <option value="Em Andamento">Em Andamento</option>
        <option value="Resolvido">Resolvido</option>
      </select>
      <input type="text" id="criador" placeholder="Criado por (ex: Jo√£o Silva)">
      <div style="display:flex;justify-content:space-between;">
        <button class="cancel" id="cancelar">Cancelar</button>
        <button class="save" id="salvar">Salvar</button>
      </div>
    </div>
  </div>

  <script>
    const modal = document.getElementById('modal');
    const lista = document.getElementById('listaChamados');
    const total = document.getElementById('total');
    const abertos = document.getElementById('abertos');
    const andamento = document.getElementById('andamento');
    const resolvidos = document.getElementById('resolvidos');
    const salvarBtn = document.getElementById('salvar');
    const modalTitulo = document.getElementById('modalTitulo');

    let chamados = [];
    let editIndex = null;

    function salvarChamados() {
      localStorage.setItem('chamados', JSON.stringify(chamados));
    }

    function carregarChamados() {
      const salvos = localStorage.getItem('chamados');
      if (salvos) {
        chamados = JSON.parse(salvos);
        atualizarChamados();
      }
    }

    document.getElementById('novoChamadoBtn').onclick = () => {
      modal.style.display = 'flex';
      modalTitulo.textContent = "Novo Chamado";
      editIndex = null;
      document.querySelectorAll('#modal input, #modal textarea, #modal select').forEach(e => e.value = '');
    };
    document.getElementById('cancelar').onclick = () => modal.style.display = 'none';
    window.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };

    salvarBtn.onclick = () => {
      const titulo = document.getElementById('titulo').value;
      const descricao = document.getElementById('descricao').value;
      const local = document.getElementById('local').value;
      const categoria = document.getElementById('categoria').value;
      const prioridade = document.getElementById('prioridade').value;
      const status = document.getElementById('status').value;
      const criador = document.getElementById('criador').value;

      if (!titulo) return alert('Informe o t√≠tulo do chamado!');

      if (editIndex !== null) {
        chamados[editIndex] = { ...chamados[editIndex], titulo, descricao, local, categoria, prioridade, status, criador };
      } else {
        const data = new Date().toLocaleString();
        chamados.push({ titulo, descricao, local, categoria, prioridade, status, criador, data });
      }

      salvarChamados();
      modal.style.display = 'none';
      atualizarChamados();
    };

    function editarChamado(index) {
      const c = chamados[index];
      document.getElementById('titulo').value = c.titulo;
      document.getElementById('descricao').value = c.descricao;
      document.getElementById('local').value = c.local;
      document.getElementById('categoria').value = c.categoria;
      document.getElementById('prioridade').value = c.prioridade;
      document.getElementById('status').value = c.status;
      document.getElementById('criador').value = c.criador;
      modalTitulo.textContent = "Editar Chamado";
      modal.style.display = 'flex';
      editIndex = index;
    }

    function excluirChamado(index) {
      if (confirm("Tem certeza que deseja excluir este chamado?")) {
        chamados.splice(index, 1);
        salvarChamados();
        atualizarChamados();
      }
    }

    function atualizarChamados() {
      lista.innerHTML = "";
      const fs = document.getElementById('filterStatus').value;
      const fc = document.getElementById('filterCategoria').value;
      const fp = document.getElementById('filterPrioridade').value;

      const filtrados = chamados.filter(c =>
        (fs === "todos" || c.status === fs) &&
        (fc === "todas" || c.categoria === fc) &&
        (fp === "todas" || c.prioridade === fp)
      );

      if (filtrados.length === 0) {
        lista.className = "empty";
        lista.textContent = "Nenhum chamado encontrado com os filtros selecionados.";
      } else {
        lista.className = "";
        filtrados.forEach((c, index) => {
          const div = document.createElement("div");
          div.className = "chamado";
          div.innerHTML = `
            <div class="chamado-header">
              <span><strong>#${index + 1}</strong></span>
              <span class="status ${c.status.replace(' ', '')}">${c.status}</span>
            </div>
            <strong>${c.titulo}</strong>
            <p class="descricao">${c.descricao || "‚Äî"}</p>
            <div class="detalhes">
              <span>üìç ${c.local || "Local n√£o informado"}</span>
              <span>‚öôÔ∏è ${c.categoria}</span>
              <span>‚ö†Ô∏è ${c.prioridade}</span>
              <span>‚è∞ ${c.data}</span>
            </div>
            <p class="criador">Criado por: ${c.criador || "An√¥nimo"}</p>
            <div class="acoes">
              <button class="edit" onclick="editarChamado(${index})">‚úèÔ∏è</button>
              <button class="delete" onclick="excluirChamado(${index})">üóëÔ∏è</button>
            </div>
          `;
          lista.appendChild(div);
        });
      }

      total.textContent = chamados.length;
      abertos.textContent = chamados.filter(c => c.status === "Aberto").length;
      andamento.textContent = chamados.filter(c => c.status === "Em Andamento").length;
      resolvidos.textContent = chamados.filter(c => c.status === "Resolvido").length;
    }

    document.getElementById('filterStatus').onchange = atualizarChamados;
    document.getElementById('filterCategoria').onchange = atualizarChamados;
    document.getElementById('filterPrioridade').onchange = atualizarChamados;

    document.getElementById('logoutBtn').addEventListener('click', () => {
      window.location.href = 'home.html';
    });

    carregarChamados();
  </script>
</body>
</html>
